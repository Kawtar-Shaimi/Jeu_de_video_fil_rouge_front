<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Magasin de Jeux Vidéo</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css" />
    <script src="./js/jquery-3.6.0.min.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/service.js"></script>
    <script src="./js/app.js"></script>

    <style>
      body {
        padding: 20px;
      }
      .img-thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
      }
      .nav-tabs {
        margin-bottom: 20px;
      }
      .tab-content {
        min-height: 400px;
      }
      .badge {
        font-size: 0.8em;
      }
    </style>
  </head>
  <body>
    <h1 class="text-center">🎮 Magasin de Jeux Vidéo</h1>
    
    <!-- Toast container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
      <div
        id="liveToast"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header">
          <strong class="me-auto">Notification</strong>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body">Message de notification</div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="clients-tab" data-bs-toggle="tab" data-bs-target="#clients" type="button" role="tab">
          👥 Clients
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="jeux-tab" data-bs-toggle="tab" data-bs-target="#jeux" type="button" role="tab">
          🎮 Jeux
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="ventes-tab" data-bs-toggle="tab" data-bs-target="#ventes" type="button" role="tab">
          💰 Ventes
        </button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="myTabContent">
      
      <!-- CLIENTS TAB -->
      <div class="tab-pane fade show active" id="clients" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#clientModal">
            Ajouter Client
          </button>
          <input type="text" id="searchClient" class="form-control w-50" placeholder="Rechercher un client..." />
        </div>
        
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Email</th>
              <th>Téléphone</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="clientTable"></tbody>
        </table>
      </div>

      <!-- JEUX TAB -->
      <div class="tab-pane fade" id="jeux" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#jeuModal">
            🎮 Ajouter Jeu
          </button>
          <input type="text" id="searchJeu" class="form-control w-50" placeholder="Rechercher un jeu..." />
        </div>
        
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Titre</th>
              <th>Type</th>
              <th>Prix</th>
              <th>Genre</th>
              <th>Stock</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="jeuTable"></tbody>
        </table>
      </div>

      <!-- VENTES TAB -->
      <div class="tab-pane fade" id="ventes" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#venteModal">
            Nouvelle Vente
          </button>
          <div class="btn-group">
            <button class="btn btn-outline-secondary" data-filter="all">Toutes</button>
            <button class="btn btn-outline-warning" data-filter="EN_ATTENTE">En Attente</button>
            <button class="btn btn-outline-info" data-filter="CONFIRMEE">Confirmées</button>
            <button class="btn btn-outline-success" data-filter="LIVREE">Livrées</button>
            <button class="btn btn-outline-danger" data-filter="ANNULEE">Annulées</button>
          </div>
        </div>
        
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Date</th>
              <th>Client</th>
              <th>Jeu</th>
              <th>Quantité</th>
              <th>Montant Total</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="venteTable"></tbody>
        </table>
      </div>
    </div>

    <!-- MODALS -->
    
    <!-- Client Modal -->
    <div class="modal fade" id="clientModal" tabindex="-1">
      <div class="modal-dialog">
        <form id="clientForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Nouveau Client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Nom</label>
              <input type="text" id="clientNom" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" id="clientEmail" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Téléphone</label>
              <input type="tel" id="clientPhone" class="form-control" required />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Ajouter</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Client Modal -->
    <div class="modal fade" id="editClientModal" tabindex="-1">
      <div class="modal-dialog">
        <form id="editClientForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modifier Client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editClientId" />
            <div class="mb-3">
              <label class="form-label">Nom</label>
              <input type="text" id="editClientNom" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" id="editClientEmail" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Téléphone</label>
              <input type="tel" id="editClientPhone" class="form-control" required />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Sauvegarder</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Vente Modal -->
    <div class="modal fade" id="venteModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <form id="venteForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Nouvelle Vente - Transaction Multiple</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Client *</label>
              <select id="venteClient" class="form-control" required>
                <option value="">Sélectionner un client</option>
              </select>
            </div>
            
            <hr>
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6>🎮 Jeux à acheter</h6>
              <button type="button" class="btn btn-primary btn-sm" id="addGameBtn">
                + Ajouter un jeu
              </button>
            </div>
            
            <div id="gamesContainer">
              <!-- Game rows will be added here dynamically -->
            </div>
            
            <div class="mb-3">
              <div id="ventePreview" class="alert alert-info" style="display:none;">
                <strong>Résumé de la transaction:</strong>
                <div id="venteDetails"></div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button class="btn btn-success" type="submit">Créer Vente</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1">
      <div class="modal-dialog">
        <form id="statusForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modifier Statut</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="statusVenteId" />
            <div class="mb-3">
              <label class="form-label">Nouveau Statut</label>
              <select id="statusSelect" class="form-control" required>
                <option value="EN_ATTENTE">En Attente</option>
                <option value="CONFIRMEE">Confirmée</option>
                <option value="LIVREE">Livrée</option>
                <option value="ANNULEE">Annulée</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Mettre à jour</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Game Modal -->
    <div class="modal fade" id="jeuModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <form id="jeuForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">🎮 Nouveau Jeu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Titre *</label>
                  <input type="text" id="jeuTitre" class="form-control" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Prix (€) *</label>
                  <input type="number" id="jeuPrix" class="form-control" step="0.01" min="0" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Genre *</label>
                  <select id="jeuGenre" class="form-control" required>
                    <option value="">Sélectionner un genre</option>
                    <option value="Action">Action</option>
                    <option value="Adventure">Adventure</option>
                    <option value="RPG">RPG</option>
                    <option value="Strategy">Strategy</option>
                    <option value="Simulation">Simulation</option>
                    <option value="Sports">Sports</option>
                    <option value="Racing">Racing</option>
                    <option value="Fighting">Fighting</option>
                    <option value="Puzzle">Puzzle</option>
                    <option value="Horror">Horror</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Éditeur *</label>
                  <input type="text" id="jeuEditeur" class="form-control" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Stock Disponible *</label>
                  <input type="number" id="jeuStock" class="form-control" min="0" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Type *</label>
                  <select id="jeuType" class="form-control" required>
                    <option value="">Sélectionner un type</option>
                    <option value="PC">PC</option>
                    <option value="Console">Console</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- PC Specific Fields -->
            <div id="pcFields" style="display: none;">
              <hr>
              <h6>🖥️ Spécifications PC <span class="text-danger">*</span></h6>
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-3">
                    <label class="form-label">Configuration Minimale *</label>
                    <textarea id="jeuConfigMin" class="form-control" rows="3" placeholder="Ex: Windows 10, 8GB RAM, GTX 1060" required></textarea>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Support DVD</label>
                    <div class="form-check">
                      <input type="checkbox" id="jeuSupportDVD" class="form-check-input">
                      <label class="form-check-label" for="jeuSupportDVD">
                        Disponible en DVD
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Console Specific Fields -->
            <div id="consoleFields" style="display: none;">
              <hr>
              <h6>🎮 Spécifications Console <span class="text-danger">*</span></h6>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Plateforme *</label>
                    <select id="jeuPlateforme" class="form-control" required>
                      <option value="">Sélectionner une plateforme</option>
                      <option value="PlayStation 5">PlayStation 5</option>
                      <option value="PlayStation 4">PlayStation 4</option>
                      <option value="Xbox Series X/S">Xbox Series X/S</option>
                      <option value="Xbox One">Xbox One</option>
                      <option value="Nintendo Switch">Nintendo Switch</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Code Région *</label>
                    <select id="jeuRegionCode" class="form-control" required>
                      <option value="">Sélectionner une région</option>
                      <option value="EU">Europe (EU)</option>
                      <option value="US">États-Unis (US)</option>
                      <option value="JP">Japon (JP)</option>
                      <option value="AS">Asie (AS)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-plus"></i> Créer Jeu
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        loadClients();
        loadJeux();
        loadVentes();
        setupEventHandlers();
      });
    </script>
  </body>
</html>
